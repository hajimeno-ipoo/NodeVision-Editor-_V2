<svg xmlns="http://www.w3.org/2000/svg" width="1400" height="1100" viewBox="0 0 1400 1100"><style>
text{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans CJK JP','Noto Sans JP',Meiryo,Arial,sans-serif;font-size:16px;fill:#111}
.caption{font-size:20px;font-weight:600}
.actor,.participant{fill:#fff;stroke:#444;stroke-width:1.5}
.lifeline{stroke:#999;stroke-width:1;stroke-dasharray:6 6}
.msg{stroke:#444;stroke-width:1.5;fill:none;marker-end:url(#arrow)}
.note{fill:#fff3cd;stroke:#e0c36c}
</style>
<defs><marker id="arrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
<polygon points="0 0, 10 3.5, 0 7" fill="#444"/></marker></defs>
<text x="24" y="30" class="caption">NodeVision Edit : Inspect &amp; Run（シーケンス）</text><rect x="60.0" y="60" width="120" height="36" rx="8" ry="8" class="actor"/><text x="120" y="84" text-anchor="middle">User</text><line x1="120" y1="96" x2="120" y2="1060" class="lifeline" /><rect x="280.0" y="60" width="160" height="36" rx="8" ry="8" class="participant"/><text x="360" y="84" text-anchor="middle">Renderer(UI)</text><line x1="360" y1="96" x2="360" y2="1060" class="lifeline" /><rect x="540.0" y="60" width="160" height="36" rx="8" ry="8" class="participant"/><text x="620" y="84" text-anchor="middle">Main(IPC)</text><line x1="620" y1="96" x2="620" y2="1060" class="lifeline" /><rect x="800.0" y="60" width="160" height="36" rx="8" ry="8" class="participant"/><text x="880" y="84" text-anchor="middle">Engine</text><line x1="880" y1="96" x2="880" y2="1060" class="lifeline" /><rect x="1060.0" y="60" width="160" height="36" rx="8" ry="8" class="participant"/><text x="1140" y="84" text-anchor="middle">ffprobe/ffmpeg</text><line x1="1140" y1="96" x2="1140" y2="1060" class="lifeline" /><text x="700.0" y="140" text-anchor="middle" fill="#666">== Inspect (Concat 事前検証) ==</text><line x1="120" y1="164" x2="360" y2="164" class="msg" /><text x="240.0" y="158" text-anchor="middle">ノード編集</text><line x1="360" y1="200" x2="620" y2="200" class="msg" /><text x="490.0" y="194" text-anchor="middle">engine:inspectConcat(req)</text><line x1="620" y1="236" x2="880" y2="236" class="msg" /><text x="750.0" y="230" text-anchor="middle">inspectConcat(req)</text><line x1="880" y1="272" x2="1140" y2="272" class="msg" /><text x="1010.0" y="266" text-anchor="middle">ffprobe x N (w,h,fps,pix_fmt,sar,duration)</text><line x1="1140" y1="308" x2="880" y2="308" class="msg" /><text x="1010.0" y="302" text-anchor="middle">メタ情報の配列</text><line x1="880" y1="344" x2="620" y2="344" class="msg" /><text x="750.0" y="338" text-anchor="middle">resp{ ok, canConcat, equality or E2001 }</text><line x1="620" y1="380" x2="360" y2="380" class="msg" /><text x="490.0" y="374" text-anchor="middle">resp</text><rect x="240" y="390" width="760" height="120" rx="8" ry="8" class="note"/><text x="248" y="412" text-anchor="start">alt canConcat = true / false</text><text x="258" y="438" text-anchor="start">true: 編集続行 or Export 実行へ</text><text x="258" y="464" text-anchor="start">false: E2001 バナー表示（正規化案内）</text><text x="700.0" y="534" text-anchor="middle" fill="#666">== Run (実行) ==</text><line x1="120" y1="558" x2="360" y2="558" class="msg" /><text x="240.0" y="552" text-anchor="middle">Export クリック</text><line x1="360" y1="594" x2="620" y2="594" class="msg" /><text x="490.0" y="588" text-anchor="middle">engine:run(runRequest)</text><line x1="620" y1="630" x2="880" y2="630" class="msg" /><text x="750.0" y="624" text-anchor="middle">run(runRequest)</text><line x1="880" y1="666" x2="1140" y2="666" class="msg" /><text x="1010.0" y="660" text-anchor="middle">ffmpeg &amp;lt;args[]&amp;gt;</text><line x1="1140" y1="702" x2="880" y2="702" class="msg" /><text x="1010.0" y="696" text-anchor="middle">stderr(progress) / preview frames</text><line x1="880" y1="738" x2="620" y2="738" class="msg" /><text x="750.0" y="732" text-anchor="middle">job:progress / preview:frame</text><line x1="620" y1="774" x2="360" y2="774" class="msg" /><text x="490.0" y="768" text-anchor="middle">進捗/プレビュー配信</text><rect x="240" y="794" width="420" height="74" rx="8" ry="8" class="note" /><text x="250" y="818" text-anchor="start">Cancel:</text><text x="250" y="840" text-anchor="start">engine:cancel → SIGINT→(3s)→SIGKILL</text><line x1="1140" y1="894" x2="880" y2="894" class="msg" /><text x="1010.0" y="888" text-anchor="middle">exit(code)</text><rect x="360" y="930" width="680" height="90" rx="8" ry="8" class="note" /><text x="370" y="954" text-anchor="start">結果:</text><text x="370" y="976" text-anchor="start">success: 履歴更新(20件ローテ)・ログ保存・completed</text><text x="370" y="998" text-anchor="start">failure: エラーバナー表示・ログ参照・failed</text></svg>