# セカンダリーグレーディング 総合テストガイド

## 概要
このガイドでは、Secondary Gradingノードの色補正機能が正しく動作するかを確認します。
**画像・動画・書き出しの3つの状態で同じ補正結果が得られること**を検証します。

---

## テスト素材

以下の素材を使用してテストを行います：

| ファイル | パス | 解像度 |
|---------|------|--------|
| サンプル画像 | `doc/001-frames.png` | 768×1344 |
| サンプル動画 | `doc/サンプル動画.mp4` | 768×1344 (約20秒) |

**注意**: 画像と動画は同じフレームを含むため、同じパラメータで同じ結果が得られることを確認できます。

---

## テスト準備

### ノード配線

**パターンA: 画像テスト**
```
Load Image → Secondary Grading → Media Preview
```

**パターンB: 動画テスト**
```
Load Video → Secondary Grading → Media Preview
```

**パターンC: 書き出しテスト**
```
Load Image/Video → Secondary Grading → Output
```

### 素材の読み込み
1. `Load Image` または `Load Video` ノードをキャンバスに配置
2. 「アップロードするファイルを選択」をクリック
3. `doc/001-frames.png` または `doc/サンプル動画.mp4` を選択
4. プレビューに画像が表示されることを確認

---

## テスト1: HSL Qualifier - Hue（色相選択）

### 1-1. Hue Center の動作確認

**手順**: Show Mask を ON にしてからテスト

| パラメータ設定 | 期待される結果（マスク表示） |
|--------------|---------------------------|
| Center = 0, Width = 40 | 赤い部分のみ白、他は黒 |
| Center = 30, Width = 30 | 肌トーン・オレンジ系の部分が白 |
| Center = 120, Width = 40 | 緑の部分のみ白 |
| Center = 210, Width = 40 | 青い部分のみ白 |

**確認ポイント**:
- ✅ OK: Centerを動かすとマスクの白い部分が色相に沿って移動する
- ❌ NG: 白い範囲が変化しない、または全体が一様に変わる

### 1-2. Hue Width の動作確認

| パラメータ設定 | 期待される結果 |
|--------------|--------------|
| Center = 30（肌色付近）, Width = 10 | 狭い肌色範囲のみ白 |
| Center = 30（肌色付近）, Width = 40 | 広めの肌色～オレンジが白 |
| Center = 30（肌色付近）, Width = 80 | 赤～黄色まで広く白 |

- ✅ OK: Widthを広げると白い範囲が広がる
- ❌ NG: 範囲が変わらない

### 1-3. Hue Softness の動作確認

| パラメータ設定 | 期待される結果 |
|--------------|--------------|
| Softness = 0 | 白黒の境界がはっきり |
| Softness = 20 | 境界がグラデーションになる |
| Softness = 50 | 境界が大きくぼける |

- ✅ OK: Softnessを上げると境界がなめらかになる
- ❌ NG: 境界の見え方が変わらない

---

## テスト2: HSL Qualifier - Saturation（彩度選択）

### 2-1. Saturation Center の動作確認

| パラメータ設定 | 期待される結果 |
|--------------|--------------|
| Center = 0.1, Width = 0.2 | 彩度の低い部分（灰色、白など）が白 |
| Center = 0.5, Width = 0.2 | 中程度の彩度の部分が白 |
| Center = 0.9, Width = 0.2 | 鮮やかな部分が白 |

- ✅ OK: Center低で彩度が低い部分、Center高で鮮やかな部分がマスクされる
- ❌ NG: 設定に関わらず同じ部分が白い

---

## テスト3: HSL Qualifier - Luminance（輝度選択）

### 3-1. Luminance Center の動作確認

| パラメータ設定 | 期待される結果 |
|--------------|--------------|
| Center = 0.1, Width = 0.2 | 暗い影部分が白 |
| Center = 0.5, Width = 0.2 | 中間調が白 |
| Center = 0.9, Width = 0.2 | 明るいハイライトが白 |

- ✅ OK: Lum Centerで明暗の選択が切り替わる
- ❌ NG: 設定に関わらず同じ部分が白い

---

## テスト4: Invert Selection

| 操作 | 期待される結果 |
|-----|--------------|
| Invert OFF | 選択した範囲が白 |
| Invert ON | 選択した範囲以外が白 |

- ✅ OK: マスクの白黒が反転する
- ❌ NG: 変化なし

---

## テスト5: Correction - 選択範囲への補正適用

**前提**: Show Mask OFF で実際の補正効果を確認

### 5-1. Saturation（彩度補正）

**テスト設定**:
```
Hue Center: 30    Width: 30    Softness: 15
（肌トーンを選択）
```

| Saturation値 | 期待される結果 |
|-------------|--------------|
| Saturation = 1.5 | 肌の彩度が上がる（より血色が良く見える） |
| Saturation = 0.5 | 肌の彩度が下がる（青白く見える） |

- ✅ OK: 肌だけ彩度が変化、背景は変化なし
- ❌ NG: 全体の彩度が変わる

### 5-2. Hue Shift（色相シフト）

**テスト設定**:
```
Hue Center: 30    Width: 30    Softness: 15
（肌トーンを選択）
```

| Hue Shift値 | 期待される結果 |
|------------|--------------|
| Hue Shift = +20 | 肌が黄色っぽくなる |
| Hue Shift = -20 | 肌がピンク～赤っぽくなる |

- ✅ OK: 肌だけ色相が回転、他の色は変化なし
- ❌ NG: 全体の色が回転する

### 5-3. Brightness（明度補正）

**テスト設定**:
```
Lum Center: 0.3    Width: 0.3    Softness: 0.15
（暗い部分を選択）
```

| Brightness値 | 期待される結果 |
|-------------|--------------|
| Brightness = 1.3 | 影だけが明るくなる |
| Brightness = 0.7 | 影がより暗くなる |

- ✅ OK: 選択範囲のみ明度が変化
- ❌ NG: 全体が明るく/暗くなる

### 5-4. Intensity（効果強度）

| 設定 | 期待される結果 |
|-----|--------------|
| Intensity = 0.0 | 補正効果なし（元画像と同じ） |
| Intensity = 0.5 | 補正効果が半分の強さ |
| Intensity = 1.0 | 補正効果がフル（デフォルト） |

- ✅ OK: Intensityで効果の強さが調整される
- ❌ NG: 変化なし

---

## テスト6: 画像と動画の一貫性テスト 🔴重要

**目的**: 同じパラメータで`001-frames.png`と`サンプル動画.mp4`が同じ補正結果になることを確認

### テスト手順

#### Step 1: 画像で補正を確認

1. Load Image で `doc/001-frames.png` を読み込み
2. Secondary Grading → Media Preview を接続
3. 以下の設定を適用：

**設定A（肌補正）**:
```
Hue Center: 30     Width: 30     Softness: 15
Sat Center: 0.5    Width: 0.5    Softness: 0.1
Lum Center: 0.5    Width: 0.5    Softness: 0.1
Saturation: 1.2
Hue Shift: 0
Brightness: 1.1
Intensity: 1.0
```

4. 結果を目視で記憶（または画面キャプチャ）

#### Step 2: 動画で同じ設定を適用

1. Load Video で `doc/サンプル動画.mp4` を読み込み
2. Secondary Grading → Media Preview を接続
3. Step 1と**全く同じパラメータ**を設定
4. 動画のフレームを確認

#### Step 3: 比較判定

| 確認項目 | OK | NG |
|---------|----|----|
| 肌の彩度 | 画像と動画で同じ程度に上がっている | 動画のみ効果が弱い/強い |
| 肌の明るさ | 画像と動画で同じ程度に明るい | 動画のみ暗い/明るすぎる |
| 背景の変化 | 画像も動画も背景は変化なし | どちらかで背景が変わっている |
| 色相 | 画像と動画で同じ色味 | 動画のみ色が違う |

---

## テスト7: 書き出し一貫性テスト 🔴重要

**目的**: プレビューと書き出し結果が同じ補正であることを確認

### 7-1. 画像書き出しテスト

1. Load Image (`doc/001-frames.png`) → Secondary Grading → Output
2. テスト6の「設定A（肌補正）」を適用
3. 画像を書き出し
4. 書き出した画像を別のビューアで開く

**確認ポイント**:
- ✅ OK: 書き出し画像がプレビューと同じ補正結果
- ❌ NG: 書き出し画像は無補正、または補正が違う

### 7-2. 動画書き出しテスト

1. Load Video (`doc/サンプル動画.mp4`) → Secondary Grading → Output
2. テスト6の「設定A（肌補正）」を適用
3. 動画を書き出し
4. 書き出した動画を再生

**確認ポイント**:
- ✅ OK: 書き出し動画が全フレームでプレビューと同じ補正
- ❌ NG: 書き出し動画は無補正、または一部フレームのみ適用

---

## テスト8: レイヤー機能テスト

### 8-1. レイヤー独立性

1. Layer 1 で設定：
   ```
   Hue Center: 30（肌選択）
   Saturation: 1.3（彩度アップ）
   ```
2. `+ Add` でLayer 2追加
3. Layer 2 で設定：
   ```
   Lum Center: 0.2（影選択）
   Brightness: 1.2（明るく）
   ```

**確認ポイント**:
- ✅ OK: 肌は彩度アップ + 影は明るくなる（両方同時に適用）
- ❌ NG: Layer 1の設定がLayer 2に影響する

### 8-2. レイヤー切り替え

- Layer 1タブとLayer 2タブを切り替え
- ✅ OK: 各レイヤーの設定値が保持されている
- ❌ NG: 切り替えると値がリセットされる

---

## テスト9: 複合条件テスト

### 9-1. Hue + Saturation の組み合わせ

**目的**: 「鮮やかな肌色だけ」を選択できるか

```
Hue Center: 30     Width: 30     Softness: 15
Sat Center: 0.6    Width: 0.3    Softness: 0.1
```

**期待される結果**: 鮮やかな肌色部分のみマスクされる（薄い肌色や灰色は除外）

### 9-2. Hue + Luminance の組み合わせ

**目的**: 「明るい肌のハイライトだけ」を選択できるか

```
Hue Center: 30     Width: 30     Softness: 15
Lum Center: 0.7    Width: 0.2    Softness: 0.1
```

**期待される結果**: 肌の明るい部分（ハイライト）のみマスクされる（影部分は除外）

---

## 実用シナリオテスト

### シナリオA: 肌を健康的に見せる

**設定値**:
```
Hue Center: 30     Width: 25     Softness: 20
Sat Center: 0.5    Width: 0.4    Softness: 0.15
Saturation: 1.15
Brightness: 1.05
Hue Shift: -5（やや赤み追加）
```

**期待される結果**:
- 肌: やや赤みが増し、明るく健康的に見える
- 背景: 変化なし
- 服: 変化なし（肌色と大きく違う場合）

**画像・動画・書き出しで確認**:
- [ ] 画像プレビューで肌が健康的に見える
- [ ] 動画プレビューで同じ効果
- [ ] 書き出し画像で同じ効果
- [ ] 書き出し動画で同じ効果

### シナリオB: 影を持ち上げる（暗部補正）

**設定値**:
```
Lum Center: 0.2    Width: 0.25   Softness: 0.2
Brightness: 1.25
Saturation: 1.1（暗部の色を少し戻す）
```

**期待される結果**:
- 暗い部分: 明るくなり、ディテールが見える
- 明るい部分: ほぼ変化なし
- ハイライト: 変化なし

**画像・動画・書き出しで確認**:
- [ ] 画像プレビューで影が明るくなる
- [ ] 動画プレビューで同じ効果
- [ ] 書き出し画像で同じ効果
- [ ] 書き出し動画で同じ効果

### シナリオC: ハイライトを抑える

**設定値**:
```
Lum Center: 0.85   Width: 0.15   Softness: 0.1
Brightness: 0.9
Saturation: 1.05（色を維持）
```

**期待される結果**:
- ハイライト: やや暗くなる
- 中間調: ほぼ変化なし
- 暗部: 変化なし

**画像・動画・書き出しで確認**:
- [ ] 画像プレビューでハイライトが落ち着く
- [ ] 動画プレビューで同じ効果
- [ ] 書き出し画像で同じ効果
- [ ] 書き出し動画で同じ効果

---

## エラーパターンと対処法

| 症状 | 原因 | 対処法 |
|-----|-----|-------|
| 画像と動画で結果が違う | LUT生成のタイミング差 | ノード再接続、設定を再適用 |
| 書き出しに補正が反映されない | LUT生成エラー | アプリ再起動後、再書き出し |
| 全体が同じ色になる | Width が広すぎ | Width を狭める |
| マスクが真っ白 | 全色が選択されている | Width を狭める |
| マスクが真っ黒 | 選択範囲がない | Center/Widthを調整 |
| 動画がカクつく | WebGL負荷 | 解像度を下げて確認 |
| プレビューが表示されない | 接続エラー | ノードを移動または再接続 |

---

## 最終確認チェックリスト

### 基本動作
- [ ] Hue Center でマスクが色相に沿って移動する
- [ ] Saturation Center で彩度に基づいて選択できる
- [ ] Luminance Center で明度に基づいて選択できる
- [ ] Width で選択範囲の広さが変わる
- [ ] Softness で境界のぼかしが変わる
- [ ] Invert で選択が反転する

### 補正適用
- [ ] Saturation で選択範囲のみ彩度が変わる
- [ ] Hue Shift で選択範囲のみ色相が回転する
- [ ] Brightness で選択範囲のみ明度が変わる
- [ ] Intensity で効果の強さが調整できる

### 一貫性（最重要）
- [ ] `001-frames.png` と `サンプル動画.mp4` で同じパラメータで同じ結果
- [ ] 画像書き出しでプレビューと同じ補正が適用される
- [ ] 動画書き出しでプレビューと同じ補正が適用される

### レイヤー
- [ ] 複数レイヤーが独立して動作する
- [ ] レイヤー切り替えで設定が保持される

---

## テスト結果記録

| テスト項目 | 画像 | 動画 | 画像書き出し | 動画書き出し |
|-----------|------|------|-------------|-------------|
| Hue 選択 | ☐ | ☐ | - | - |
| Sat 選択 | ☐ | ☐ | - | - |
| Lum 選択 | ☐ | ☐ | - | - |
| 彩度補正 | ☐ | ☐ | ☐ | ☐ |
| 色相補正 | ☐ | ☐ | ☐ | ☐ |
| 明度補正 | ☐ | ☐ | ☐ | ☐ |
| シナリオA | ☐ | ☐ | ☐ | ☐ |
| シナリオB | ☐ | ☐ | ☐ | ☐ |
| シナリオC | ☐ | ☐ | ☐ | ☐ |

**テスト実施日**: ____年__月__日
**テスト担当者**: ________________
**備考**: ________________

---

これで「ノードにあるスライダーを動かすと何がどう変わるか」を確かめやすくなるよ！ 🎨
