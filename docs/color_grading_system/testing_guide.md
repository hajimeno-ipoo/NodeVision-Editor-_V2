# カラーグレーディングシステム - 実機テストチェックリスト

## 📋 テスト概要

このドキュメントは、実装したカラーグレーディング機能の動作確認のための実機テストガイドです。
各ノードの接続方法と確認項目を記載しています。

---

## 🔧 事前準備

### 必要なもの
- [ ] テスト用の画像ファイル（JPEG, PNG など）
- [ ] テスト用の動画ファイル（MP4 など、オプション）
- [ ] .cube形式のLUTファイル（オプション）

### アプリケーション起動
```bash
pnpm dev
```

---

## 1️⃣ Color Correctionノードのテスト

### ノード構成図
```
┌─────────────┐     ┌──────────────────┐     ┌───────────────┐
│ Load Image  │────▶│ Color Correction │────▶│ Media Preview │
└─────────────┘     └──────────────────┘     └───────────────┘
```

### 接続手順
1. 左のノードリストから「**Load Image**」をキャンバスにドラッグ
2. Load Imageノードの「Open File」ボタンでテスト画像を選択
3. 「**Color Correction**」ノードをキャンバスに追加
4. 「**Media Preview**」ノードをキャンバスに追加
5. 接続:
   - `Load Image` の `Media` 出力ポート → `Color Correction` の `Source` 入力ポート
   - `Color Correction` の `Result` 出力ポート → `Media Preview` の `Source` 入力ポート

### 確認項目
- [x] ノードが正常に追加できる
- [x] 画像がLoad Imageノードに表示される
- [x] 動画がLoad Videoノードでプレビューされる（静止画だけでなく動画も対応）
- [x] Brightnessスライダーを動かすとプレビューが更新される
- [x] Contrastスライダーを動かすとプレビューが更新される
- [x] Saturationスライダーを動かすとプレビューが更新される
- [x] Gamma, Exposure, Shadows, Highlights, Temperature, Tintも動作する
- [x] 各パラメータのReset（リセット）ボタンが機能する（アイコンクリックで動作、ノード選択されない）

### 期待される結果
- Media Previewノードに色補正された画像が表示される
- 動画の場合もリアルタイムでプレビューされる（WebGLVideoProcessorによる）
- スライダー操作に対してリアルタイムでプレビューが更新される
- WebGL 2.0 (3D LUT)のインジケーターが表示される
- リセットボタンが正しく機能し、アイコンクリックで動作する

---

## 2️⃣ Primary Gradingノード（カラーホイール）のテスト

### ノード構成図
```
┌─────────────┐     ┌──────────────────┐     ┌───────────────┐
│ Load Image  │────▶│ Primary Grading  │────▶│ Media Preview │
└─────────────┘     └──────────────────┘     └───────────────┘
```

### 接続手順
1. Load Imageノードで画像を読み込む
2. **Primary Grading**ノードを追加
3. Media Previewノードを追加
4. 接続:
   - `Load Image` → `Primary Grading` → `Media Preview`

### 確認項目
- [ ] Lift/Gamma/Gainタブが表示される
- [ ] 各タブでカラーホイールが表示される
- [ ] カラーホイール上でドラッグすると色相と彩度が調整できる
- [ ] 中央のドットで輝度（Luminance）が調整できる
- [ ] Exposure, Contrast, Saturation, Temperature, Tintスライダーが動作する
- [ ] プレビューがリアルタイムで更新される

### 期待される結果
- DaVinci Resolveスタイルのカラーホイールで直感的に調整できる
- Lift（シャドウ）、Gamma（ミッドトーン）、Gain（ハイライト）を個別調整できる

---

## 3️⃣ Curvesノードのテスト

### ノード構成図
```
┌─────────────┐     ┌────────┐     ┌───────────────┐
│ Load Image  │────▶│ Curves │────▶│ Media Preview │
└─────────────┘     └────────┘     └───────────────┘
```

### 接続手順
1. Load Imageノードで画像を読み込む
2. **Curves**ノードを追加
3. Media Previewノードを追加
4. 接続:
   - `Load Image` → `Curves` → `Media Preview`

### 確認項目

#### RGBカーブ
- [ ] Master/Red/Green/Blueタブが表示される
- [ ] カーブ上をクリックしてコントロールポイントを追加できる
- [ ] コントロールポイントをドラッグして移動できる
- [ ] コントロールポイントをダブルクリックで削除できる（両端以外）
- [ ] グリッドと対角線（基準線）が表示される
- [ ] 各チャンネルで色が異なる（Master:白, Red:赤, Green:緑, Blue:青）

#### Hueカーブ（新機能）
- [ ] Hue Hueタブが表示される（色相シフト）
- [ ] Hue Satタブが表示される（彩度調整）
- [ ] Hue Lumaタブが表示される（輝度調整）
- [ ] 各Hueカーブでポイント追加/削除/ドラッグができる
- [ ] プレビューがリアルタイムで更新される

#### リセット機能
- [ ] 「Reset [チャンネル名]」ボタンで個別チャンネルをリセットできる
- [ ] 「Reset All Curves」ボタンで全チャンネルをリセットできる

### 期待される結果
- Catmull-Romスプライン補間による滑らかなカーブ調整
- 特定の色相に対する高度な調整が可能

---

## 4️⃣ LUT Loaderノードのテスト

### ノード構成図
```
┌─────────────┐     ┌─────────────┐     ┌───────────────┐
│ Load Image  │────▶│ LUT Loader  │────▶│ Media Preview │
└─────────────┘     └─────────────┘     └───────────────┘
```

### 接続手順
1. Load Imageノードで画像を読み込む
2. **LUT Loader**ノードを追加
3. Media Previewノードを追加
4. 接続:
   - `Load Image` → `LUT Loader` → `Media Preview`

### 確認項目
- [ ] ノードに「LUTファイルを読み込む」ボタンが表示される
- [ ] ボタンをクリックするとファイル選択ダイアログが開く
- [ ] .cubeファイルを選択できる
- [ ] LUT読み込み後、ファイル名が表示される
- [ ] Intensityスライダーが表示される（0-100%）
- [ ] Intensityスライダーでエフェクトの強さを調整できる
- [ ] プレビューがリアルタイムで更新される

### 期待される結果
- 外部の.cube LUTファイルを読み込んで適用できる
- 任意の解像度のLUTファイルに対応（17³, 33³, 65³など）

### 注意事項
> .cubeファイルがない場合はこのテストはスキップ可能です。
> テスト用LUTは以下から入手できます：
> - [Free LUTs - RocketStock](https://www.rocketstock.com/free-after-effects-templates/35-free-luts-for-color-grading-videos/)

---

## 5️⃣ Secondary Gradingノードのテスト

### ノード構成図
```
┌─────────────┐     ┌────────────────────┐     ┌───────────────┐
│ Load Image  │────▶│ Secondary Grading  │────▶│ Media Preview │
└─────────────┘     └────────────────────┘     └───────────────┘
```

### 接続手順
1. カラフルな画像（複数の色が含まれる）を読み込む
2. **Secondary Grading**ノードを追加
3. Media Previewノードを追加
4. 接続:
   - `Load Image` → `Secondary Grading` → `Media Preview`

### 確認項目

#### HSL Qualifier
- [ ] Hueセクション: Center, Width, Softnessスライダーが動作する
- [ ] Saturationセクション: Center, Width, Softnessスライダーが動作する
- [ ] Luminanceセクション: Center, Width, Softnessスライダーが動作する
- [ ] 「Invert Selection」チェックボックスが機能する
- [ ] 「Show Mask」チェックボックスで選択範囲が白黒表示される

#### Correction
- [ ] Saturationスライダーが選択した色相のみに適用される
- [ ] Hue Shiftスライダーが選択した色相をシフトする
- [ ] Brightnessスライダーが選択した色相の明度を変更する

### 期待される結果
- 特定の色（例：空の青、肌の色）だけを選択して調整できる
- Show Maskで選択範囲を視覚的に確認できる

---

## 6️⃣ Scope Viewerノードのテスト ⭐新機能

### ノード構成図
```
┌─────────────┐     ┌───────────────┐
│ Load Image  │────▶│ Media Preview │
└─────────────┘     └───────────────┘
       │
       └───────────▶┌───────────────┐
                    │ Scope Viewer  │
                    └───────────────┘
```

### 接続手順
1. Load Imageノードでカラフルな画像を読み込む
2. **Scope Viewer**ノードを追加
3. オプションでMedia Previewノードも追加
4. 接続:
   - `Load Image` の `Media` 出力 → `Scope Viewer` の `Source` 入力
   - `Load Image` の `Media` 出力 → `Media Preview` の `Source` 入力（オプション）

### 確認項目
- [ ] Scope Typeドロップダウンが表示される
- [ ] 「RGB Histogram」が選択できる
- [ ] ヒストグラムが自動的に表示される
- [ ] Redチャンネル（赤色、半透明）が表示される
- [ ] Greenチャンネル（緑色、半透明）が表示される
- [ ] Blueチャンネル（青色、半透明）が表示される
- [ ] Luminance（グレー、半透明）が表示される
- [ ] RGBが重なった部分が白っぽく見える
- [ ] 異なる画像を接続すると、ヒストグラムが更新される

### 期待される結果
- 画像の色分布を256ビンで可視化
- プロフェッショナルツールのような重ね合わせ表示

### 将来の機能（Coming Soon表示）
- [ ] Waveform
- [ ] Vectorscope

---

## 7️⃣ 複雑なパイプライン（チェーン接続）のテスト

### ノード構成図
```
┌─────────────┐     ┌──────────────────┐     ┌────────┐     ┌────────────────────┐     ┌───────────────┐
│ Load Image  │────▶│ Primary Grading  │────▶│ Curves │────▶│ Secondary Grading  │────▶│ Media Preview │
└─────────────┘     └──────────────────┘     └────────┘     └────────────────────┘     └───────────────┘
       │
       └───────────▶┌───────────────┐
                    │ Scope Viewer  │
                    └───────────────┘
```

### 接続手順
1. Load Imageノードで画像を読み込む
2. Primary Grading, Curves, Secondary Gradingを順次追加
3. Media PreviewとScope Viewerを追加
4. 上記の図のように接続

### 確認項目
- [ ] 複数のノードを連鎖できる
- [ ] 各段階で色が順次変化する
- [ ] Scope Viewerで元画像の分布を確認できる
- [ ] 最後のMedia Previewに全ての調整が反映される
- [ ] パフォーマンスが許容範囲内（プレビュー更新が1秒以内）

### 期待される結果
- DaVinci Resolveのようなノードベースのワークフロー
- 各ステージで異なる調整を積み重ねられる

---

## 8️⃣ ビデオエクスポートのテスト

### ノード構成図
```
┌─────────────┐     ┌────────┐     ┌────────┐
│ Load Video  │────▶│ Curves │────▶│ Export │
└─────────────┘     └────────┘     └────────┘
```

### 接続手順
1. **Load Video**ノードで短い動画を読み込む（10秒以下推奨）
2. Curvesノードなどで調整
3. **Export**ノードに接続
4. エクスポート設定を行い、「Export」ボタンをクリック

### 確認項目
- [ ] Load Videoノードで動画を読み込める
- [ ] プレビューと書き出しの色が一致する
- [ ] FFmpegで.cubeファイルが生成される
- [ ] 書き出された動画にカラーグレーディングが適用されている

### 期待される結果
- プレビューと書き出し結果が完全に一致
- 3D LUT方式により高品質なカラーグレーディング

---

## 🐛 トラブルシューティング

### プレビューが表示されない
1. ブラウザの開発者ツール（Cmd+Option+I）でConsoleを確認
2. ターミナルでエラーメッセージを確認
3. ノードの接続が正しいか確認（ポートの色が一致しているか）

### LUT Loaderでファイルが読めない
- .cube形式のファイルか確認
- ファイルの構文が正しいか確認（`LUT_3D_SIZE`が記載されているか）

### パフォーマンスが遅い
- 画像サイズを小さくする（1920x1080以下推奨）
- 接続するノードの数を減らす
- LUT解像度を下げる（33³推奨）

### Scope Viewerにヒストグラムが表示されない
- 画像が正しく接続されているか確認
- ブラウザのConsoleでエラーを確認
- 画像のファイル形式を確認（JPEG, PNG推奨）

### Color Correctionノードで動画プレビューが黒くなる/表示されない
- WebGLVideoProcessorが正しく初期化されているか確認
- ブラウザの開発者ツールでConsoleエラーを確認
- 動画ファイルの形式が対応しているか確認（MP4, WebM推奨）
- ノードを一度切断して再接続してみる
- アプリを再起動してみる

### リセットボタンをクリックしてもノード選択状態になる
- リセットボタンのアイコン上ではなく、ボタンの縁をクリックしている可能性
- 最新版のコードでは `pointer-events: none` がアイコンに適用済みのため修正済み
- アプリをリロード（Cmd+R）して最新版を反映させる

---

## ✅ テスト完了チェックリスト

以下の項目が全て完了したら、実機テスト成功です！

- [x] Color Correctionノードが正常に動作
- [ ] Primary Gradingノード（カラーホイール）が正常に動作
- [ ] Curvesノード（RGB + Hue）が正常に動作
- [ ] LUT Loaderノードが正常に動作
- [ ] Secondary Gradingノードが正常に動作
- [ ] Scope Viewerノードが正常に動作
- [ ] 複数ノードのチェーン接続が正常に動作
- [ ] ビデオエクスポートが正常に動作
- [ ] プレビューと書き出し結果が一致

---

## 📝 フィードバック

テスト中に見つかった問題やバグは、以下の情報と一緒に報告してください：

- **発生状況**: どのノードで、どの操作をしたか
- **期待される動作**: 本来どうなるべきか
- **実際の動作**: 実際にどうなったか
- **エラーメッセージ**: Consoleやターミナルのエラー
- **スクリーンショット**: 可能であれば添付

---

**テスト実施日**: _____________

**テスト実施者**: _____________

**全体評価**: ⭐⭐⭐⭐⭐
