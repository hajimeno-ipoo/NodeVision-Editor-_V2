## 変更内容
`apps/desktop-electron/src/renderer/nodes/lut-loader.ts` を修正し、動画プレビュー機能を追加しました。

### 主な変更点
1.  **動画プロセッサーの状態管理追加**
    - `videoProcessors`: アクティブな動画要素（`HTMLVideoElement`）をノードIDごとに管理
    - `videoCleanup`: クリーンアップ関数（ループ停止、要素破棄）を管理

2.  **ソースメディア種別の判定ロジック強化**
    - `getSourceMedia` 関数を拡張し、URLだけでなく種別（`image` または `video`）を返すように変更
    - `loadVideo` ノードからの入力を正しく動画として認識するように修正

3.  **動画プレビュー更新ループの実装**
    - 動画入力の場合、専用の `HTMLVideoElement` を作成して再生
    - `requestAnimationFrame` を使用した更新ループ内で以下を実行：
        - `processor.loadVideoFrame(video)`: 動画フレームをテクスチャとして読み込み
        - `processor.renderWithCurrentTexture()`: LUTを適用してレンダリング
        - `propagateToMediaPreview`: レンダリング結果をプレビューノードに反映

4.  **リソース管理とクリーンアップ**
    - ノード削除時やソース変更時に `cancelAnimationFrame` と動画要素の破棄（`pause`, `src=''`）を確実に実行


### ビルドと起動
1.  プロジェクトをビルドし、エラーがないことを確認してください。
    ```bash
    npm run build
    ```
2.  アプリケーションを起動してください。
    ```bash
    npm run start
    ```

### 動画プレビューの動作確認
1.  **Load Video** ノードを追加し、適当な動画ファイル（mp4等）を読み込んでください。
2.  **LUT Loader** ノードを追加し、Load Video ノードと接続してください。
3.  **LUT Loader** ノードに `.cube` ファイルを読み込んでください。
4.  **Media Preview** ノードを LUT Loader ノードに接続してください。
5.  **期待される動作**:
    - Media Preview で動画が再生され、LUT適用済みの色味で表示されること。
    - Intensity スライダーを動かすと、リアルタイムで動画の色味が変化すること。
    - 動画がループ再生されること。

### 画像プレビューの回帰テスト
1.  **Load Image** ノードを追加し、画像ファイルを読み込んでください。
2.  **LUT Loader** ノードに接続してください。
3.  **期待される動作**:
    - 従来通り静止画が表示され、LUTが適用されること。
    - Intensity スライダーで色味が変化すること。

### 切り替えテスト
1.  同じ LUT Loader ノードに対して、Load Video と Load Image の接続を切り替えてください。
2.  **期待される動作**:
    - 動画 → 画像、画像 → 動画 の切り替えがスムーズに行われ、プレビューが正しく更新されること。
    - 切り替え時にエラーが発生しないこと。

## 既知の制限事項
- 高解像度・高フレームレートの動画では、プレビューの更新速度が低下する可能性があります（Data URL経由でのDOM更新のため）。

### 書き出し（エクスポート）の動作確認
1.  **動画書き出し**
    - 上記手順で作成したフロー（Load Video -> LUT Loader -> Export）で、「Export」ボタンを押して動画（mp4）を書き出してください。
    - 書き出された動画を再生し、LUTが適用されていることを確認してください。
    - **Intensity** を `0.5` などに下げて再度書き出し、適用強度が反映されている（色が薄くなっている）ことを確認してください。

### 3. バグ修正の確認
#### エクスポート時のLUT適用
1. LUT Loaderを含むフローを作成します。
2. エクスポートを実行します（画像または動画）。
3. 出力ファイルを開き、**プレビューと同じ色味**になっていることを確認します。
   - 修正前は、LUTが適用されずオリジナルの色味で出力されていました。

#### 動画プレビューのLUT更新
1. LUT Loaderに動画を入力し、プレビューします。
2. 「別のLUTを読み込む」ボタンで、明らかに色味が異なる別のLUTを選択します。
3. **動画プレビューの色味が即座に変わる**ことを確認します。
   - 修正前は、動画の場合のみ古いLUTが維持されていました。
2.  **画像書き出し**
    - Load Image -> LUT Loader -> Export のフローで画像を書き出してください。
    - 書き出された画像にLUTが適用されていることを確認してください。
